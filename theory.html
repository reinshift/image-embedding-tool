<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原理介绍 - 图像嵌入工具</title>
    <!-- 预加载关键资源 -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js" as="script">

    <!-- 样式表 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css">
    <link rel="stylesheet" href="theory-style.css">

    <!-- 内联关键CSS以减少渲染阻塞 -->
    <style>
        /* 数学公式占位符样式，避免布局跳动 */
        .katex-display:empty {
            min-height: 2.5em;
            background: linear-gradient(90deg, #f0f0f0 25%, transparent 25%, transparent 50%, #f0f0f0 50%, #f0f0f0 75%, transparent 75%);
            background-size: 20px 20px;
            animation: loading-shimmer 1.5s infinite;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .inline-math:empty {
            min-width: 2em;
            min-height: 1.2em;
            background: linear-gradient(90deg, #f0f0f0 25%, transparent 25%, transparent 50%, #f0f0f0 50%, #f0f0f0 75%, transparent 75%);
            background-size: 10px 10px;
            animation: loading-shimmer 1.5s infinite;
            border-radius: 3px;
            display: inline-block;
        }

        @keyframes loading-shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }

        /* 优化字体加载 */
        .katex {
            font-display: swap; /* 使用系统字体直到KaTeX字体加载完成 */
        }
    </style>
</head>
<body>
    <div class="theory-container">
        <!-- 导航栏 -->
        <nav class="theory-nav">
            <div class="nav-content">
                <div class="nav-brand">
                    <img src="default-logo.svg" alt="Logo" class="nav-logo">
                    <span class="nav-title">原理介绍</span>
                </div>
                <button class="back-btn" onclick="goBackToApp()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    返回应用
                </button>
            </div>
        </nav>

        <!-- 主内容 -->
        <div class="theory-content">
            <div class="container">
                <!-- 目录 -->
                <div class="toc-section">
                    <h2 class="toc-title">目录</h2>
                    <ul class="toc-list">
                        <li><a href="#background">1. 引言：图像嵌入的数学背景</a></li>
                        <li><a href="#homography-definition">2. 单应性变换的定义与性质</a></li>
                        <li><a href="#mathematical-formulation">3. 单应性变换的数学表达</a></li>
                        <li><a href="#homography-matrix">4. 单应矩阵的结构与求解</a></li>
                        <li><a href="#pseudoinverse-theory">5. 广义逆理论</a></li>
                        <li><a href="#solution-method">6. 单应矩阵的求解方法</a></li>
                        <li><a href="#application-example">7. 图像嵌入的完整数学过程</a></li>
                    </ul>
                </div>

                <!-- 1. 引言：图像嵌入的数学背景 -->
                <section id="background" class="theory-section">
                    <h2 class="section-title">1. 引言：图像嵌入的数学背景</h2>

                    <div class="content-block">
                        <h3>1.1 问题的数学描述</h3>
                        <p>考虑图像嵌入问题：给定源图像 <span class="inline-math" id="source-image"></span> 和目标图像 <span class="inline-math" id="target-image"></span>，我们希望将源图像变换后嵌入到目标图像的指定区域。</p>

                        <p>设源图像为矩形区域，其四个角点为：</p>
                        <div class="math-block">
                            <div class="katex-display" id="source-corners"></div>
                        </div>

                        <p>目标区域为一般四边形，其四个角点为：</p>
                        <div class="math-block">
                            <div class="katex-display" id="target-corners"></div>
                        </div>

                        <p>问题归结为：寻找一个变换 <span class="inline-math" id="transform-T"></span>，使得</p>
                        <div class="math-block">
                            <div class="katex-display" id="transform-mapping"></div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>1.2 几何变换的分类</h3>
                        <p>在计算机视觉和图像处理中，常见的几何变换包括：</p>

                        <div class="transform-hierarchy">
                            <div class="transform-level">
                                <strong>欧几里得变换</strong>：平移 + 旋转（保持距离和角度）
                            </div>
                            <div class="transform-level">
                                <strong>相似变换</strong>：欧几里得变换 + 均匀缩放（保持角度）
                            </div>
                            <div class="transform-level">
                                <strong>仿射变换</strong>：相似变换 + 剪切（保持平行线）
                            </div>
                            <div class="transform-level">
                                <strong>射影变换</strong>：仿射变换 + 透视变换（保持直线）
                            </div>
                        </div>

                        <p>对于图像嵌入问题，由于目标区域是一般四边形，我们需要使用<strong>射影变换</strong>（也称为单应性变换）。</p>
                    </div>

                    <div class="content-block">
                        <h3>1.3 数学预备知识</h3>
                        <p>在深入讨论单应性变换之前，我们需要回顾以下数学概念：</p>

                        <div class="math-prerequisites">
                            <div class="prereq-item">
                                <h4>齐次坐标</h4>
                                <p>二维点 <span class="inline-math" id="point-2d"></span> 的齐次坐标表示为 <span class="inline-math" id="point-homogeneous"></span></p>
                            </div>
                            <div class="prereq-item">
                                <h4>线性变换</h4>
                                <p>齐次坐标下的线性变换可表示为矩阵乘法</p>
                            </div>
                            <div class="prereq-item">
                                <h4>矩阵的秩与零空间</h4>
                                <p>求解齐次线性方程组的理论基础</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 2. 单应性变换的定义与性质 -->
                <section id="homography-definition" class="theory-section">
                    <h2 class="section-title">2. 单应性变换的定义与性质</h2>

                    <div class="content-block">
                        <h3>定义 2.1 (单应性变换)</h3>
                        <div class="definition-box">
                            <p>设 <span class="inline-math" id="plane1"></span> 和 <span class="inline-math" id="plane2"></span> 为两个平面，单应性变换是一个可逆的映射 <span class="inline-math" id="homography-map"></span>，满足：</p>
                            <ol>
                                <li>将直线映射为直线</li>
                                <li>保持交比不变</li>
                                <li>可由一个非奇异的 3×3 矩阵表示</li>
                            </ol>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>定理 2.1 (单应性变换的矩阵表示)</h3>
                        <div class="theorem-box">
                            <p>任意单应性变换都可以表示为齐次坐标下的矩阵乘法：</p>
                            <div class="math-block">
                                <div class="katex-display" id="homography-matrix-form"></div>
                            </div>
                            <p>其中 <span class="inline-math" id="H-matrix"></span> 为非奇异的 3×3 矩阵，称为单应矩阵。</p>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>性质 2.1 (单应性变换的基本性质)</h3>
                        <div class="properties-list">
                            <div class="property-item">
                                <strong>齐次性：</strong>矩阵 <span class="inline-math" id="H-scale"></span> 与 <span class="inline-math" id="H-original"></span> 表示同一变换，其中 <span class="inline-math" id="lambda-nonzero"></span>
                            </div>
                            <div class="property-item">
                                <strong>自由度：</strong>单应矩阵有8个独立参数（9个元素减去1个尺度因子）
                            </div>
                            <div class="property-item">
                                <strong>可逆性：</strong>若 <span class="inline-math" id="H-invertible"></span>，则逆变换为 <span class="inline-math" id="H-inverse"></span>
                            </div>
                            <div class="property-item">
                                <strong>群性质：</strong>单应性变换构成群，即变换的复合仍为单应性变换
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>引理 2.1 (四点确定单应性变换)</h3>
                        <div class="lemma-box">
                            <p>给定两个平面上各四个点，且每组四点中无三点共线，则存在唯一的单应性变换将第一组点映射到第二组点。</p>

                            <p><strong>证明思路：</strong>四对点提供8个约束条件，而单应矩阵有8个自由度，因此系统恰好确定。</p>
                        </div>
                    </div>
                </section>

                <!-- 3. 单应性变换的数学表达 -->
                <section id="mathematical-formulation" class="theory-section">
                    <h2 class="section-title">3. 单应性变换的数学表达</h2>

                    <div class="content-block">
                        <h3>3.1 齐次坐标表示</h3>
                        <p>在齐次坐标系下，单应性变换具有简洁的线性形式。设点 <span class="inline-math" id="point-p"></span> 在齐次坐标下表示为 <span class="inline-math" id="point-p-homo"></span>，则单应性变换为：</p>

                        <div class="math-block">
                            <div class="katex-display" id="homography-eq1"></div>
                        </div>

                        <p>其中单应矩阵 <span class="inline-math" id="H-matrix"></span> 的一般形式为：</p>
                        <div class="math-block">
                            <div class="katex-display" id="H-general-form"></div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>3.2 非齐次坐标的变换公式</h3>
                        <p>将齐次坐标转换为非齐次坐标，得到实际的变换公式：</p>

                        <div class="math-block">
                            <div class="katex-display" id="nonhomogeneous-transform"></div>
                        </div>

                        <p>这里的分母 <span class="inline-math" id="denominator"></span> 正是产生透视效果的关键因子。</p>
                    </div>

                    <div class="content-block">
                        <h3>3.3 单应矩阵的几何意义</h3>
                        <p>单应矩阵的9个参数可以分解为不同的几何变换：</p>

                        <div class="math-block">
                            <div class="katex-display" id="H-decomposition"></div>
                        </div>

                        <div class="geometric-interpretation">
                            <div class="interp-item">
                                <span class="inline-math" id="A-matrix"></span>：仿射变换部分（旋转、缩放、剪切）
                            </div>
                            <div class="interp-item">
                                <span class="inline-math" id="t-vector"></span>：平移向量
                            </div>
                            <div class="interp-item">
                                <span class="inline-math" id="v-vector"></span>：透视变换向量
                            </div>
                            <div class="interp-item">
                                <span class="inline-math" id="v-scalar"></span>：标量因子
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>3.4 变换的不变性质</h3>
                        <div class="invariant-properties">
                            <div class="invariant-item">
                                <h4>直线保持性</h4>
                                <p>直线在单应性变换下仍为直线</p>
                                <div class="math-block">
                                    <div class="katex-display" id="line-preservation"></div>
                                </div>
                            </div>
                            <div class="invariant-item">
                                <h4>交比不变性</h4>
                                <p>四个共线点的交比在变换下保持不变</p>
                                <div class="math-block">
                                    <div class="katex-display" id="cross-ratio"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 4. 单应矩阵的结构与求解 -->
                <section id="homography-matrix" class="theory-section">
                    <h2 class="section-title">4. 单应矩阵的结构与求解</h2>

                    <div class="content-block">
                        <h3>4.1 点对应约束的建立</h3>
                        <p>给定对应点对 <span class="inline-math" id="point-pair"></span>，单应性约束为：</p>

                        <div class="math-block">
                            <div class="katex-display" id="point-correspondence"></div>
                        </div>

                        <p>展开齐次坐标，得到：</p>
                        <div class="math-block">
                            <div class="katex-display" id="expanded-correspondence"></div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>4.2 线性化处理</h3>
                        <p>由于齐次坐标的尺度不确定性，我们有 <span class="inline-math" id="scale-constraint"></span>。利用向量叉积的性质：</p>

                        <div class="math-block">
                            <div class="katex-display" id="cross-product-constraint"></div>
                        </div>

                        <p>展开得到两个线性约束方程：</p>
                        <div class="math-block">
                            <div class="katex-display" id="dlt-equations"></div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>4.3 系数矩阵的构造</h3>
                        <p>对于 <span class="inline-math" id="n-points"></span> 对点，我们得到 <span class="inline-math" id="2n-equations"></span> 个线性方程。将单应矩阵向量化为 <span class="inline-math" id="h-vector"></span>，系统可写为：</p>

                        <div class="math-block">
                            <div class="katex-display" id="linear-system"></div>
                        </div>

                        <p>其中系数矩阵 <span class="inline-math" id="A-matrix-size"></span> 的第 <span class="inline-math" id="i-th-row"></span> 行为：</p>
                        <div class="math-block">
                            <div class="katex-display" id="A-matrix-rows"></div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>4.4 齐次线性方程组</h3>
                        <p>当 <span class="inline-math" id="n-equals-4"></span> 时，我们有8个方程和9个未知数。由于单应矩阵的齐次性，问题转化为求解：</p>

                        <div class="math-block">
                            <div class="katex-display" id="homogeneous-system"></div>
                        </div>

                        <p>在约束 <span class="inline-math" id="norm-constraint"></span> 下的最小二乘解。</p>
                    </div>
                </section>

                <!-- 5. 广义逆理论 -->
                <section id="pseudoinverse-theory" class="theory-section">
                    <h2 class="section-title">5. 广义逆理论</h2>

                    <div class="content-block">
                        <h3>定义 5.1 (Moore-Penrose广义逆)</h3>
                        <div class="definition-box">
                            <p>对于矩阵 <span class="inline-math" id="matrix-A"></span>，其Moore-Penrose广义逆 <span class="inline-math" id="A-pseudoinverse"></span> 是唯一满足以下四个条件的矩阵：</p>
                            <div class="math-block">
                                <div class="katex-display" id="mp-conditions"></div>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>定理 5.1 (SVD与广义逆)</h3>
                        <div class="theorem-box">
                            <p>设矩阵 <span class="inline-math" id="A-svd-form"></span> 为 <span class="inline-math" id="matrix-A"></span> 的奇异值分解，其中 <span class="inline-math" id="sigma-diagonal"></span>，则：</p>
                            <div class="math-block">
                                <div class="katex-display" id="svd-pseudoinverse"></div>
                            </div>
                            <p>其中 <span class="inline-math" id="sigma-plus"></span> 通过将 <span class="inline-math" id="sigma-matrix"></span> 中的非零奇异值取倒数得到。</p>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>5.1 广义逆的基本性质</h3>
                        <div class="properties-list">
                            <div class="property-item">
                                <strong>唯一性：</strong>Moore-Penrose广义逆是唯一的
                            </div>
                            <div class="property-item">
                                <strong>对称性：</strong><span class="inline-math" id="pseudoinverse-symmetry"></span>
                            </div>
                            <div class="property-item">
                                <strong>幂等性：</strong><span class="inline-math" id="pseudoinverse-idempotent"></span>
                            </div>
                            <div class="property-item">
                                <strong>范数性质：</strong><span class="inline-math" id="pseudoinverse-norm"></span>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>5.2 齐次线性方程组的最小范数解</h3>
                        <p>考虑齐次线性方程组 <span class="inline-math" id="homogeneous-eq"></span>，其最小范数解为：</p>

                        <div class="math-block">
                            <div class="katex-display" id="min-norm-solution"></div>
                        </div>

                        <p>其中 <span class="inline-math" id="v-min"></span> 是 <span class="inline-math" id="ATA-matrix"></span> 的最小特征值对应的特征向量。</p>
                    </div>

                    <div class="content-block">
                        <h3>引理 5.1 (最小特征值与零空间)</h3>
                        <div class="lemma-box">
                            <p>设 <span class="inline-math" id="A-rank"></span>，则：</p>
                            <ol>
                                <li><span class="inline-math" id="ATA-eigenvalues"></span> 有 <span class="inline-math" id="r-positive"></span> 个正特征值和 <span class="inline-math" id="9-r-zero"></span> 个零特征值</li>
                                <li>零特征值对应的特征空间即为 <span class="inline-math" id="A-nullspace"></span></li>
                                <li>当 <span class="inline-math" id="rank-8"></span> 时，零空间为一维，最小范数解唯一确定（除了符号）</li>
                            </ol>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>5.3 数值计算考虑</h3>
                        <div class="numerical-considerations">
                            <div class="consideration-item">
                                <h4>条件数</h4>
                                <p>矩阵 <span class="inline-math" id="condition-number"></span> 的条件数为 <span class="inline-math" id="cond-formula"></span></p>
                            </div>
                            <div class="consideration-item">
                                <h4>数值稳定性</h4>
                                <p>当 <span class="inline-math" id="sigma-min"></span> 很小时，解可能不稳定，需要正则化处理</p>
                            </div>
                            <div class="consideration-item">
                                <h4>截断SVD</h4>
                                <p>实际计算中常使用截断SVD：<span class="inline-math" id="truncated-svd"></span></p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 6. 单应矩阵的求解方法 -->
                <section id="solution-method" class="theory-section">
                    <h2 class="section-title">6. 单应矩阵的求解方法</h2>

                    <div class="content-block">
                        <h3>6.1 直接线性变换(DLT)算法</h3>
                        <p>DLT算法是求解单应矩阵的标准方法，其核心思想是将非线性问题线性化。</p>

                        <div class="algorithm-box">
                            <h4>算法 6.1 (DLT算法)</h4>
                            <p><strong>输入：</strong>对应点对 <span class="inline-math" id="input-points"></span></p>
                            <p><strong>输出：</strong>单应矩阵 <span class="inline-math" id="output-H"></span></p>

                            <ol class="algorithm-steps">
                                <li>构造系数矩阵 <span class="inline-math" id="A-construction"></span></li>
                                <li>求解 <span class="inline-math" id="min-problem"></span></li>
                                <li>将解向量重构为 3×3 矩阵</li>
                                <li>归一化使 <span class="inline-math" id="h33-normalize"></span></li>
                            </ol>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>6.2 最小二乘解的计算</h3>
                        <p>齐次线性方程组 <span class="inline-math" id="Ah-zero"></span> 的最小范数解可通过以下方法计算：</p>

                        <div class="method-comparison">
                            <div class="method-item">
                                <h4>方法1：特征值分解</h4>
                                <div class="math-block">
                                    <div class="katex-display" id="eigenvalue-method"></div>
                                </div>
                                <p>计算 <span class="inline-math" id="ATA-eigen"></span> 的最小特征值对应的特征向量</p>
                            </div>

                            <div class="method-item">
                                <h4>方法2：奇异值分解</h4>
                                <div class="math-block">
                                    <div class="katex-display" id="svd-method"></div>
                                </div>
                                <p>计算 <span class="inline-math" id="A-svd"></span>，解为 <span class="inline-math" id="V-last-column"></span></p>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>6.3 数值稳定性分析</h3>
                        <div class="stability-analysis">
                            <div class="stability-item">
                                <h4>条件数的影响</h4>
                                <p>当 <span class="inline-math" id="cond-A"></span> 很大时，解的精度下降。通常要求 <span class="inline-math" id="cond-threshold"></span>。</p>
                            </div>

                            <div class="stability-item">
                                <h4>坐标归一化</h4>
                                <p>将点坐标归一化到 <span class="inline-math" id="normalize-range"></span> 可显著改善条件数：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="normalization-transform"></div>
                                </div>
                            </div>

                            <div class="stability-item">
                                <h4>正则化技术</h4>
                                <p>当系统接近奇异时，可使用Tikhonov正则化：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="tikhonov-regularization"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>6.4 超定系统的处理</h3>
                        <p>当有超过4对点时 <span class="inline-math" id="n-greater-4"></span>，系统变为超定，此时求解最小二乘解：</p>

                        <div class="math-block">
                            <div class="katex-display" id="overdetermined-solution"></div>
                        </div>

                        <p>这种情况下，解的鲁棒性更好，但需要考虑异常点的影响。</p>

                        <div class="robust-methods">
                            <div class="robust-item">
                                <h4>RANSAC算法</h4>
                                <p>随机采样一致性算法，用于处理含有异常点的数据</p>
                            </div>
                            <div class="robust-item">
                                <h4>加权最小二乘</h4>
                                <p>根据点的可靠性分配不同权重</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 7. 图像嵌入的完整数学过程 -->
                <section id="application-example" class="theory-section">
                    <h2 class="section-title">7. 图像嵌入的完整数学过程</h2>

                    <div class="content-block">
                        <h3>7.1 问题设定</h3>
                        <p>现在我们将前面的理论应用到具体的图像嵌入问题中。</p>

                        <div class="problem-setup">
                            <div class="setup-item">
                                <h4>给定条件</h4>
                                <ul>
                                    <li>源图像：尺寸为 <span class="inline-math" id="source-size"></span> 的矩形图像</li>
                                    <li>目标区域：背景图像中用户指定的四边形区域</li>
                                    <li>对应点：<span class="inline-math" id="correspondence-points"></span></li>
                                </ul>
                            </div>
                            <div class="setup-item">
                                <h4>求解目标</h4>
                                <p>找到单应矩阵 <span class="inline-math" id="target-H"></span>，使得源图像能够正确嵌入到目标区域</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>7.2 具体计算步骤</h3>

                        <div class="calculation-steps">
                            <div class="calc-step">
                                <h4>步骤1：建立对应关系</h4>
                                <p>源图像角点（按逆时针顺序）：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="source-corners-specific"></div>
                                </div>
                                <p>目标区域角点（用户点击）：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="target-corners-specific"></div>
                                </div>
                            </div>

                            <div class="calc-step">
                                <h4>步骤2：构造线性方程组</h4>
                                <p>对于每对对应点 <span class="inline-math" id="point-pair-i"></span>，建立约束方程：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="constraint-equations"></div>
                                </div>
                                <p>四对点共产生8个线性方程，系数矩阵 <span class="inline-math" id="A-8x9"></span> 为：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="coefficient-matrix"></div>
                                </div>
                            </div>

                            <div class="calc-step">
                                <h4>步骤3：求解最小范数解</h4>
                                <p>计算 <span class="inline-math" id="ATA-computation"></span> 的特征值分解：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="eigendecomposition"></div>
                                </div>
                                <p>最小特征值 <span class="inline-math" id="lambda-min"></span> 对应的特征向量即为所求解 <span class="inline-math" id="h-solution"></span>。</p>
                            </div>

                            <div class="calc-step">
                                <h4>步骤4：重构单应矩阵</h4>
                                <p>将解向量重新排列为3×3矩阵：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="H-reconstruction"></div>
                                </div>
                                <p>归一化使 <span class="inline-math" id="h33-one"></span>（假设 <span class="inline-math" id="h33-nonzero"></span>）。</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>7.3 图像变换的实现</h3>
                        <p>得到单应矩阵后，对源图像的每个像素进行变换：</p>

                        <div class="transformation-process">
                            <div class="transform-step">
                                <h4>正向变换</h4>
                                <p>对于源图像中的点 <span class="inline-math" id="source-pixel"></span>：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="forward-transform"></div>
                                </div>
                                <p>得到目标图像中的对应位置 <span class="inline-math" id="target-position"></span>。</p>
                            </div>

                            <div class="transform-step">
                                <h4>插值处理</h4>
                                <p>由于变换后的坐标通常不是整数，使用双线性插值：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="bilinear-interpolation"></div>
                                </div>
                                <p>其中 <span class="inline-math" id="interpolation-weights"></span> 为插值权重。</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>7.4 算法复杂度分析</h3>
                        <div class="complexity-analysis">
                            <div class="complexity-item">
                                <h4>时间复杂度</h4>
                                <ul>
                                    <li>构造系数矩阵：<span class="inline-math" id="matrix-construction-complexity"></span></li>
                                    <li>特征值分解：<span class="inline-math" id="eigen-complexity"></span></li>
                                    <li>图像变换：<span class="inline-math" id="transform-complexity"></span></li>
                                    <li>总体复杂度：<span class="inline-math" id="total-complexity"></span></li>
                                </ul>
                            </div>
                            <div class="complexity-item">
                                <h4>空间复杂度</h4>
                                <ul>
                                    <li>系数矩阵存储：<span class="inline-math" id="matrix-space"></span></li>
                                    <li>图像数据：<span class="inline-math" id="image-space"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>7.5 实际应用中的考虑</h3>
                        <div class="practical-considerations">
                            <div class="consideration-item">
                                <h4>数值稳定性</h4>
                                <p>在实际应用中，需要检查系数矩阵的条件数，当 <span class="inline-math" id="condition-check"></span> 时，考虑使用正则化方法。</p>
                            </div>
                            <div class="consideration-item">
                                <h4>边界处理</h4>
                                <p>变换后的像素可能超出目标图像边界，需要进行裁剪或边界扩展处理。</p>
                            </div>
                            <div class="consideration-item">
                                <h4>质量评估</h4>
                                <p>可通过重投影误差评估变换质量：</p>
                                <div class="math-block">
                                    <div class="katex-display" id="reprojection-error"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="content-block">
                        <h3>7.6 总结</h3>
                        <div class="final-summary">
                            <p>通过本章的学习，我们完整地掌握了单应性变换在图像嵌入中的应用：</p>
                            <ol>
                                <li><strong>理论基础：</strong>单应性变换的数学定义和性质</li>
                                <li><strong>求解方法：</strong>DLT算法和广义逆理论</li>
                                <li><strong>数值计算：</strong>特征值分解和数值稳定性</li>
                                <li><strong>实际应用：</strong>图像嵌入的完整实现过程</li>
                            </ol>
                            <p>这一完整的数学框架为计算机视觉中的许多应用提供了坚实的理论基础。</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- 异步加载KaTeX以避免阻塞 -->
    <script>
        // 优化的KaTeX加载
        (function() {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js';
            script.async = true;
            script.onload = function() {
                // KaTeX加载完成后再加载theory.js
                const theoryScript = document.createElement('script');
                theoryScript.src = 'theory.js';
                theoryScript.async = true;
                document.head.appendChild(theoryScript);
            };
            script.onerror = function() {
                console.error('Failed to load KaTeX');
                // 即使KaTeX加载失败，也要加载theory.js
                const theoryScript = document.createElement('script');
                theoryScript.src = 'theory.js';
                document.head.appendChild(theoryScript);
            };
            document.head.appendChild(script);
        })();
    </script>
</body>
</html>
